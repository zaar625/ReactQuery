{"ast":null,"code":"import { isMap, isArray, isPlainObject, isSet } from './is';\nimport { includes } from './util';\nvar getNthKey = function (value, n) {\n  var keys = value.keys();\n  while (n > 0) {\n    keys.next();\n    n--;\n  }\n  return keys.next().value;\n};\nfunction validatePath(path) {\n  if (includes(path, '__proto__')) {\n    throw new Error('__proto__ is not allowed as a property');\n  }\n  if (includes(path, 'prototype')) {\n    throw new Error('prototype is not allowed as a property');\n  }\n  if (includes(path, 'constructor')) {\n    throw new Error('constructor is not allowed as a property');\n  }\n}\nexport var getDeep = function (object, path) {\n  validatePath(path);\n  for (var i = 0; i < path.length; i++) {\n    var key = path[i];\n    if (isSet(object)) {\n      object = getNthKey(object, +key);\n    } else if (isMap(object)) {\n      var row = +key;\n      var type = +path[++i] === 0 ? 'key' : 'value';\n      var keyOfRow = getNthKey(object, row);\n      switch (type) {\n        case 'key':\n          object = keyOfRow;\n          break;\n        case 'value':\n          object = object.get(keyOfRow);\n          break;\n      }\n    } else {\n      object = object[key];\n    }\n  }\n  return object;\n};\nexport var setDeep = function (object, path, mapper) {\n  validatePath(path);\n  if (path.length === 0) {\n    return mapper(object);\n  }\n  var parent = object;\n  for (var i = 0; i < path.length - 1; i++) {\n    var key = path[i];\n    if (isArray(parent)) {\n      var index = +key;\n      parent = parent[index];\n    } else if (isPlainObject(parent)) {\n      parent = parent[key];\n    } else if (isSet(parent)) {\n      var row = +key;\n      parent = getNthKey(parent, row);\n    } else if (isMap(parent)) {\n      var isEnd = i === path.length - 2;\n      if (isEnd) {\n        break;\n      }\n      var row = +key;\n      var type = +path[++i] === 0 ? 'key' : 'value';\n      var keyOfRow = getNthKey(parent, row);\n      switch (type) {\n        case 'key':\n          parent = keyOfRow;\n          break;\n        case 'value':\n          parent = parent.get(keyOfRow);\n          break;\n      }\n    }\n  }\n  var lastKey = path[path.length - 1];\n  if (isArray(parent)) {\n    parent[+lastKey] = mapper(parent[+lastKey]);\n  } else if (isPlainObject(parent)) {\n    parent[lastKey] = mapper(parent[lastKey]);\n  }\n  if (isSet(parent)) {\n    var oldValue = getNthKey(parent, +lastKey);\n    var newValue = mapper(oldValue);\n    if (oldValue !== newValue) {\n      parent[\"delete\"](oldValue);\n      parent.add(newValue);\n    }\n  }\n  if (isMap(parent)) {\n    var row = +path[path.length - 2];\n    var keyToRow = getNthKey(parent, row);\n    var type = +lastKey === 0 ? 'key' : 'value';\n    switch (type) {\n      case 'key':\n        {\n          var newKey = mapper(keyToRow);\n          parent.set(newKey, parent.get(keyToRow));\n          if (newKey !== keyToRow) {\n            parent[\"delete\"](keyToRow);\n          }\n          break;\n        }\n      case 'value':\n        {\n          parent.set(keyToRow, mapper(parent.get(keyToRow)));\n          break;\n        }\n    }\n  }\n  return object;\n};","map":{"version":3,"sources":["../../src/accessDeep.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { isMap, isArray, isPlainObject, isSet } from './is';\nimport { includes } from './util';\nvar getNthKey = function (value, n) {\n    var keys = value.keys();\n    while (n > 0) {\n        keys.next();\n        n--;\n    }\n    return keys.next().value;\n};\nfunction validatePath(path) {\n    if (includes(path, '__proto__')) {\n        throw new Error('__proto__ is not allowed as a property');\n    }\n    if (includes(path, 'prototype')) {\n        throw new Error('prototype is not allowed as a property');\n    }\n    if (includes(path, 'constructor')) {\n        throw new Error('constructor is not allowed as a property');\n    }\n}\nexport var getDeep = function (object, path) {\n    validatePath(path);\n    for (var i = 0; i < path.length; i++) {\n        var key = path[i];\n        if (isSet(object)) {\n            object = getNthKey(object, +key);\n        }\n        else if (isMap(object)) {\n            var row = +key;\n            var type = +path[++i] === 0 ? 'key' : 'value';\n            var keyOfRow = getNthKey(object, row);\n            switch (type) {\n                case 'key':\n                    object = keyOfRow;\n                    break;\n                case 'value':\n                    object = object.get(keyOfRow);\n                    break;\n            }\n        }\n        else {\n            object = object[key];\n        }\n    }\n    return object;\n};\nexport var setDeep = function (object, path, mapper) {\n    validatePath(path);\n    if (path.length === 0) {\n        return mapper(object);\n    }\n    var parent = object;\n    for (var i = 0; i < path.length - 1; i++) {\n        var key = path[i];\n        if (isArray(parent)) {\n            var index = +key;\n            parent = parent[index];\n        }\n        else if (isPlainObject(parent)) {\n            parent = parent[key];\n        }\n        else if (isSet(parent)) {\n            var row = +key;\n            parent = getNthKey(parent, row);\n        }\n        else if (isMap(parent)) {\n            var isEnd = i === path.length - 2;\n            if (isEnd) {\n                break;\n            }\n            var row = +key;\n            var type = +path[++i] === 0 ? 'key' : 'value';\n            var keyOfRow = getNthKey(parent, row);\n            switch (type) {\n                case 'key':\n                    parent = keyOfRow;\n                    break;\n                case 'value':\n                    parent = parent.get(keyOfRow);\n                    break;\n            }\n        }\n    }\n    var lastKey = path[path.length - 1];\n    if (isArray(parent)) {\n        parent[+lastKey] = mapper(parent[+lastKey]);\n    }\n    else if (isPlainObject(parent)) {\n        parent[lastKey] = mapper(parent[lastKey]);\n    }\n    if (isSet(parent)) {\n        var oldValue = getNthKey(parent, +lastKey);\n        var newValue = mapper(oldValue);\n        if (oldValue !== newValue) {\n            parent[\"delete\"](oldValue);\n            parent.add(newValue);\n        }\n    }\n    if (isMap(parent)) {\n        var row = +path[path.length - 2];\n        var keyToRow = getNthKey(parent, row);\n        var type = +lastKey === 0 ? 'key' : 'value';\n        switch (type) {\n            case 'key': {\n                var newKey = mapper(keyToRow);\n                parent.set(newKey, parent.get(keyToRow));\n                if (newKey !== keyToRow) {\n                    parent[\"delete\"](keyToRow);\n                }\n                break;\n            }\n            case 'value': {\n                parent.set(keyToRow, mapper(parent.get(keyToRow)));\n                break;\n            }\n        }\n    }\n    return object;\n};\n//# sourceMappingURL=accessDeep.js.map"]},"metadata":{},"sourceType":"module"}